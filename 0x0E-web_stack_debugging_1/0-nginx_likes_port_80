#!/usr/bin/env bash

# Check if script is being run with root privileges
if [[ $EUID -ne 0 ]]; then
   echo "This script must be run as root" 
   exit 1
fi

# Step 1: Check Nginx configuration for errors
nginx -t
if [ $? -ne 0 ]; then
    echo "Nginx configuration test failed. Please fix the configuration."
    exit 1
fi

# Step 2: Verify if Nginx service is running
if ! systemctl is-active --quiet nginx; then
    echo "Nginx service is not running. Starting nginx..."
    systemctl start nginx
fi

# Step 3: Check if anything else is listening on port 80
if netstat -tuln | grep ':80\s'; then
    echo "Another service is already listening on port 80. Please stop it or reconfigure Nginx."
    exit 1
fi

# Step 4: Adjust Nginx configuration if needed
# For example, edit /etc/nginx/nginx.conf or specific site configuration files in /etc/nginx/sites-available

# Step 5: Restart Nginx service
systemctl restart nginx

echo "Nginx is now listening on port 80 of all active IPv4 IPs"

